<section id="formulario" class="Formulario" aria-labelledby="form-title">
  <div class="box">
    <p id="form-title" class="Title">¿Tienes cosas para enviar?</p>

    <form class="Notas" (ngSubmit)="enviarFormulario(formEnvio)" #formEnvio="ngForm" novalidate>

      <!-- HONEYPOT anti-spam (oculto para humanos, visible para bots) -->
      <input
        type="text"
        name="website"
        [(ngModel)]="honeypot"
        autocomplete="off"
        tabindex="-1"
        aria-hidden="true"
        style="position:absolute;left:-10000px;opacity:0"
      />

      <!-- NOMBRE -->
      <label for="name" class="sr-only">Nombre completo</label>
      <input
        class="cuadro"
        type="text"
        id="name"
        name="UserName"
        placeholder="Nombre Completo"
        [(ngModel)]="formData.UserName"
        #UserNameCtrl="ngModel"
        required
        minlength="2"
        pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ ]+"
        title="Solo letras"
        (keypress)="onlyLetters($event)"
        aria-required="true"
        aria-label="Nombre completo"
      />
      <div class="error" *ngIf="submitted && UserNameCtrl.invalid">
        <small *ngIf="UserNameCtrl.errors?.['required']">El nombre es obligatorio.</small>
        <small *ngIf="UserNameCtrl.errors?.['minlength']">Debe tener al menos 2 caracteres.</small>
        <small *ngIf="UserNameCtrl.errors?.['pattern']">Usa solo letras y espacios.</small>
      </div>

      <!-- TELÉFONO (opcional, formateado a E.164 por intl-tel-input en TS) -->
      <label for="phone" class="sr-only">Teléfono</label>
      <input
        #phoneInput
        class="cuadro"
        type="tel"
        id="phone"
        name="PhoneUser"
        [(ngModel)]="formData.PhoneUser"
        #PhoneUserCtrl="ngModel"
        placeholder="Número de teléfono"
        inputmode="numeric"
        title="Solo números (se convertirá a formato internacional)"
        (keypress)="onlyNumbers($event)"
        aria-label="Número de teléfono"
      />
      <div class="error" *ngIf="submitted && PhoneUserCtrl.invalid">
        <small>Teléfono inválido.</small>
      </div>

      <!-- EMAIL -->
      <label for="email" class="sr-only">Correo electrónico</label>
      <input
        class="cuadro"
        type="email"
        id="email"
        name="EmailUser"
        placeholder="Email"
        [(ngModel)]="formData.EmailUser"
        #EmailUserCtrl="ngModel"
        required
        email
        aria-required="true"
        aria-label="Correo electrónico"
      />
      <div class="error" *ngIf="submitted && EmailUserCtrl.invalid">
        <small *ngIf="EmailUserCtrl.errors?.['required']">El email es obligatorio.</small>
        <small *ngIf="EmailUserCtrl.errors?.['email']">Formato de email inválido.</small>
      </div>

      <!-- NOTAS -->
      <label for="review" class="sr-only">Notas</label>
      <textarea
        class="cuadro"
        id="review"
        name="ReviewUser"
        placeholder="Notas"
        [(ngModel)]="formData.ReviewUser"
        #ReviewUserCtrl="ngModel"
        aria-label="Notas"
        rows="4"
      ></textarea>

      <div class="enviar">
        <!-- TÉRMINOS -->
        <div class="terms">
          <input
            type="checkbox"
            id="check"
            name="acceptedTerms"
            [(ngModel)]="formData.acceptedTerms"
            #AcceptedTermsCtrl="ngModel"
            required
            aria-required="true"
          />
          <label for="check">
            Acepto los
            <a href="/terminos" target="_blank" rel="noopener">términos y condiciones</a>.
          </label>
        </div>
        <div class="error" *ngIf="submitted && AcceptedTermsCtrl.invalid">
          <small *ngIf="AcceptedTermsCtrl.errors?.['required']">Debes aceptar los términos.</small>
        </div>

        <!-- BOTÓN -->
        <button
          type="submit"
          [disabled]="formEnvio.invalid || loading"
          [attr.aria-disabled]="(formEnvio.invalid || loading) ? 'true' : 'false'"
          aria-live="polite"
        >
          {{ loading ? 'Enviando…' : 'Enviar' }}
        </button>
      </div>

    </form>

    <!-- Botón de depuración (opcional) -->
    <!--
    <div style="margin-top:12px;">
      <button type="button" (click)="testWrite()" class="btn btn-ghost" [disabled]="loadingTest">
        {{ loadingTest ? 'Probando…' : 'Probar escritura (DEBUG)' }}
      </button>
    </div>
    -->
  </div>
</section>
